---
format:
  pdf:
    documentclass: scrbook
    linestretch: "1.5"
    fig-pos: 'htb'
    include-in-header: 
      text: |
        \usepackage{typearea}
        \renewcommand{\topfraction}{.85} 
        \renewcommand{\bottomfraction}{.7}
        \renewcommand{\textfraction}{.15}
        \renewcommand{\floatpagefraction}{.66}
---

# Macroegalitarianism Around the World

```{r setup, include=FALSE}
options(tinytex.verbose = TRUE)

knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  cache = TRUE,
  dpi = 1000,
  fig.width=7,
  fig.height = 2.5
)
# If `DCPOtools` is not yet installed:
# remotes::install_github("fsolt/DCPOtools")

# If `ggpattern` is not yet installed:
# remotes::install_github("coolbutuseless/ggpattern")

library(broom.mixed)
library(cmdstanr)
library(countrycode)
library(corrplot)
library(DCPOtools)
library(furrr)
library(ggthemes)
library(ggpattern)
library(here)
library(lme4)
library(patchwork)
library(rnaturalearth) # maps
library(rnaturalearthdata) # maps
library(sf) # maps
library(ggh4x) # fixed-size facets with force_panelsizes
library(rsdmx) # read directors data
library(tidyverse)

set.seed(324)
plan(multisession, workers = 8)
```

```{r functions}
sim_and_tidy_lm <- function(m) {
  m_sims <- m %>%
    map(. %>% arm::sim(n.sims = 100)) %>%
    map_df(. %>% slot("coef") %>% as_tibble())
  # Generate a tidy dataframe of results (cf. broom::tidy())
  m_tidy <- tibble(term = names(m_sims),
                   estimate = summarise_all(m_sims, list(mean)) %>%
                     t() %>%
                     as.vector(),
                   std.error = m_sims %>%
                     summarise_all(list(sd)) %>%
                     t() %>%
                     as.vector())  
  return(m_tidy)
}

region_country_trends <- function(region) {
  region_countries_pge_list %>% 
    pluck(region) %>% 
    imap(\(country_data, country_name) {
      country_data %>% 
        map(\(draw)
            lm(pge ~ year +
                 I(year^2),
               data = draw)) %>% 
        sim_and_tidy_lm() %>% 
        mutate(country = country_name)
    }) %>% 
    list_rbind()
}

```

As outlined in the previous chapter, public opinion toward gender roles constitutes one of the primary explanations for women's exclusion from the traditionally masculine public sphere of the workforce, political power, and policy influence [see, e.g., @Paxton2021, 113-114].
Despite its theoretical importance, the extent to which gender egalitarian public opinion matters for these outcomes has drawn little sustained attention.
The reason for this disconnect between explanation and evidence is that, despite a half century of calls for more and better data on these collective attitudes [see @RuleKrauss1974, 1719], what we have available to us remains inadequate for fully examining their causes and consequences.
Although national and cross-national surveys have included a plethora of relevant questions, but their concentration has been sporadic and the variety of these survey items renders the resulting data incomparable.
As a consequence, cross-national research has been constrained to study countries at just one or a few time points [see, e.g., @Paxton2003; @Alexander2012; @Glas2020] or to rely on proxies such as predominant religion or the percentage of women in office [see, e.g., @Burns2001, 340-341; @Claveria2014; @Barnes2018].
Cross-national and longitudinal investigation of, for example, the argument that such "attitudes influence both the supply of, and demand for, female candidates" has remained persistently a topic for future research [@Paxton2010, 47].

This chapter presents the latest version of the Public Gender Egalitarianism (PGE) dataset, which is based on the host of national and cross-national survey data available and recent advances in latent variable modeling of public opinion that allow us to make use of this sparse and incomparable data.
It provides comparable estimates of the public's attitudes on gender equality in the public sphere of politics and paid work across countries and over time.
We show that these PGE scores are strongly correlated with responses to single survey items as well as with measures of women's participation in the workforce and in the boardroom.
The PGE data are an invaluable source for studying the causes and consequences of macroegalitarianism over time in countries around the world, and they serve as the measure of our concept of macroegalitarianism in many of the analyses we present in later chapters.

```{r dcpo_input_raw_pge, include=FALSE, eval=FALSE}
surveys_pge <- read_csv(here("paper", "measuring_egalitarianism", "data-raw", "surveys_pge.csv"),
                        col_types = "cccccnn")

dcpo_input_raw_pge <- dcpo_setup(vars = surveys_pge,
                                 datapath = here("..",
                                                 "data",
                                                 "dcpo_surveys"),
                                 file = here("paper",
                                             "measuring_egalitarianism",
                                             "data",
                                             "dcpo_input_raw_pge.csv"))

```

```{r dcpo_input_raw_balance, include=FALSE, eval=FALSE}
surveys_egr_balance <- read_csv(here("paper",
                                     "measuring_egalitarianism",
                                     "data-raw",
                                     "surveys_egr_classification.csv"),
                                col_types = "ccccnnn") %>% 
  filter(agreed == 3)

dcpo_input_raw_balance <- dcpo_setup(vars = surveys_pge,
                                     datapath = here("..",
                                                     "data",
                                                     "dcpo_surveys"),
                                     file = here("paper",
                                                 "measuring_egalitarianism", 
                                                 "data",                                                       "dcpo_input_raw_balance.csv"))

```

```{r egr_summary_stats, cache = TRUE, cache.extra = tools::md5sum(here("paper", "measuring_egalitarianism", "data", "dcpo_input_raw_pge.csv"))}
surveys_pge <- read_csv(here("paper",
                             "measuring_egalitarianism",
                             "data-raw",
                             "surveys_pge.csv"),
                        col_types = "cccccnn")

dcpo_input_raw_pge <- read_csv(here("paper",
                                    "measuring_egalitarianism",
                                    "data",
                                    "dcpo_input_raw_pge.csv"),
                               col_types = "cdcddcd")

dcpo_input_raw_balance <- read_csv(here("paper",
                                        "measuring_egalitarianism",
                                        "data",
                                        "dcpo_input_raw_balance.csv"),
                                   col_types = "cdcddcd")

process_dcpo_input_raw <- function(dcpo_input_raw_df) {
  dcpo_input_raw_df %>% 
    with_min_yrs(2) %>% 
    with_min_cy(5) %>% 
    filter(year >= 1972) %>% 
    group_by(country) %>% 
    mutate(cc_rank = n()) %>% 
    ungroup() %>% 
    arrange(-cc_rank)
} 

dcpo_input_raw_pge1 <- process_dcpo_input_raw(dcpo_input_raw_pge)
dcpo_input_raw_balance1 <- process_dcpo_input_raw(dcpo_input_raw_balance)

n_surveys <- surveys_pge %>% 
  distinct(survey) %>% 
  nrow()

n_items <- dcpo_input_raw_pge1 %>%
  distinct(item) %>% 
  nrow()

n_countries <- dcpo_input_raw_pge1 %>%
  distinct(country) %>% 
  nrow()

n_cy <- dcpo_input_raw_pge1 %>%
  distinct(country, year) %>% 
  nrow() %>% 
  scales::comma()

n_years <- as.integer(summary(dcpo_input_raw_pge1$year)[6]-summary(dcpo_input_raw_pge1$year)[1])

spanned_cy <- dcpo_input_raw_pge1 %>% 
  group_by(country) %>% 
  summarize(years = max(year) - min(year) + 1) %>% 
  summarize(n = sum(years)) %>% 
  pull(n) %>% 
  scales::comma()

total_cy <- {n_countries * n_years} %>% 
  scales::comma()

year_range <- paste("from",
                    summary(dcpo_input_raw_pge1$year)[1],
                    "to",
                    summary(dcpo_input_raw_pge1$year)[6])

n_cyi <- dcpo_input_raw_pge1 %>% 
  distinct(country, year, item) %>% 
  nrow() %>% 
  scales::comma()

back_to_numeric <- function(string_number) {
  string_number %>% 
    str_replace(",", "") %>% 
    as.numeric()
}

covered_share_of_spanned <- {back_to_numeric(n_cy)/back_to_numeric(spanned_cy) * 100}
```


## Source Data on Public Gender Egalitarianism

National and cross-national surveys have often included questions tapping attitudes toward equality for women and men over the past half-century, but the resulting data are both sparse, that is, unavailable for many countries and years, and incomparable, generated by many different survey items.
Moreover, not all of those questions may in fact be relevant to our inquiry, which focuses on views toward gender equality in the traditionally masculine public sphere of paid work and politics.
The questions we did select are nearly always explicit in comparing men and women, but a few, such as the Eurobarometer item asking responses to the statement "Women do not have the necessary qualities and skills to fill positions of responsibility in politics," leave men's traditional role implicit.
Similarly, they nearly always explicitly invoke either paid work or politics, though they may also be broader, such as the Pew Research Center's item that asks, "On a different subject, do you think women should have equal rights with men, or shouldnâ€™t they?"

We carefully distinguished these questions from three other categories of questions on gender equality.
First, we did not include the small set of questions focusing on gender equality in the traditionally feminine private sphere of housework and childcare, such as "Men should take as much responsibility as women for the home and children," asked (with differing response categories) in the European Values Survey and the European Social Survey.
Second, we also excluded questions asking respondents how women should balance opportunities in the public sphere with their traditional duties in the private sphere, such as whether mothers in the workforce can have similarly warm relationships with their children as mothers who are not, asked in the World Values Survey and many others.
Given that attitudes that women should prioritize housework and childcare over paid employment and politics---or convictions that there will be negative consequences if they do not---can be expected to lead to less gender egalitarian opinions with regard to these latter, public-sphere activities, this is clearly a very closely related set of items to those we sought, and there are many of them. (It is telling, though not surprising, that the complementary set of questions, on how _men_ should balance responsibilities in the private sphere with their traditional roles in the public sphere, is only rarely included in surveys; one laudable example of this mostly unasked sort of question, apparently first included in Australia's 1989 National Social Science Survey and slowly becoming more common, is the item querying respondents the extent to which they agree with the statement, "Family life often suffers when men concentrate too much on their work.")
The third and final category of excluded survey items includes respondents' views on various forms of women's domination by men, from whether wives should always adopt their husbands' surnames through the recognition that various forms of sexual harassment are not "flattering" to the justifiability of intimate partner violence committed by husbands.
In each case, as the included questions are not _directly_ relevant to gender egalitarianism in the public sphere, we concluded that to ensure that the PGE scores tap only a single dimension of attitudes, we would exclude these others.

In all, we identified `r n_items` survey items on gender equality in the public sphere that were asked in no fewer than five country-years in countries surveyed at least twice; these items were drawn from `r n_surveys` different survey datasets.
The two most common items include one on politics and one on the workplace.
The first, included in the World Values Survey, the AmericasBarometer, and others, asked respondents' reactions to the statement, "On the whole, men make better political leaders than women do."
The second, included in the European Values Survey and others, asked the extent of their agreement with the claim, "When jobs are scarce, men should have more right to a job than women."
The complete list of public gender egalitarianism survey items is included in Appendix A.

Together, the survey items in the source data were asked in `r n_countries` different countries in at least two time points over `r n_years` years, `r year_range`, yielding a total of `r n_cyi` country-year-item observations.
Observations for every year in each country surveyed would number `r total_cy`, and a complete set of country-year-items would encompass `r {n_countries * n_years * n_items} %>% scales::comma()` observations.
Compared to this complete set of country-year-items, the available data can be seen to be very, very sparse.
From a more optimistic standpoint, we note there there are `r n_cy` country-years in which we have at least _some_ information about the public gender egalitarianism of the population, that is, some `r round(covered_share_of_spanned)`% of the `r spanned_cy` country-years spanned by the data we collected.
But there can be no denying Claveria's [-@Claveria2014] observation that the many different survey items employed renders these data incomparable and difficult to use together.

```{r item_and_country_plots, fig.height = 3.5, fig.cap = "Countries and Years with the Most Observations in the PGE Source Data \\label{item_country_plots}"}
items_plot <- dcpo_input_raw_pge1 %>%
  distinct(country, year, item) %>%
  count(item) %>%
  arrange(desc(n)) %>% 
  head(12) %>% 
  ggplot(aes(forcats::fct_reorder(item, n, .desc = TRUE), n)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ylab("Country-Years\nObserved") +
  ggtitle("Items")

polileader4_cy <- dcpo_input_raw_pge1 %>% filter(item == "polileader4") %>% distinct(country, year) %>% nrow()

polileader4_surveys <- dcpo_input_raw_pge1 %>% filter(item == "polileader4") %>% distinct(survey) %>% pull(survey)

countries_plot <- dcpo_input_raw_pge1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country)) %>% 
  distinct(country, year, item) %>% 
  count(country) %>%
  arrange(desc(n)) %>% 
  head(12) %>% 
  ggplot(aes(forcats::fct_reorder(country, n, .desc = TRUE), n)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ylab("Year-Items\nObserved") +
  ggtitle("Countries")

cby_plot <- dcpo_input_raw_pge1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country),
         country = stringr::str_replace(country, "South", "S.")) %>% 
  distinct(country, year) %>%
  count(country) %>% 
  arrange(desc(n)) %>% 
  head(12) %>% 
  ggplot(aes(forcats::fct_reorder(country, n, .desc = TRUE), n)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ylab("Years\nObserved") +
  ggtitle("Countries")


ybc_plot <- dcpo_input_raw_pge1 %>%
  distinct(country, year) %>%
  count(year, name = "nn") %>%
  ggplot(aes(year, nn)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        # axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ylab("Countries\nObserved") +
  ggtitle("Years")

us_obs <- dcpo_input_raw_pge1 %>% 
  distinct(country, year, item) %>%
  count(country) %>%
  filter(country == "United States") %>%
  pull(n)

others <- dcpo_input_raw_pge1 %>%
  distinct(country, year, item) %>%
  count(country) %>%
  arrange(desc(n)) %>%
  slice(2:5) %>%
  pull(country) %>% 
  knitr::combine_words()

countries_cp <- dcpo_input_raw_pge1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country),
         country = stringr::str_replace(country, "South", "S.")) %>% 
  distinct(country, year, item) %>%
  count(country) %>% 
  arrange(desc(n)) %>% 
  head(12) %>% 
  pull(country)

countries_cbyp <- dcpo_input_raw_pge1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country),
         country = stringr::str_replace(country, "South", "S.")) %>% 
  distinct(country, year) %>%
  count(country) %>% 
  arrange(desc(n)) %>% 
  head(12) %>% 
  pull(country)

adding <- setdiff(countries_cbyp, countries_cp) %>% 
  knitr::combine_words()

dropping <- setdiff(countries_cp, countries_cbyp) %>% 
  str_replace("S.", "South") %>% 
  knitr::combine_words()

y_peak_year <- dcpo_input_raw_pge1 %>%
  distinct(country, year) %>%
  count(year, name = "nn") %>% 
  filter(nn == max(nn)) %>% 
  pull(year)

y_peak_nn <- dcpo_input_raw_pge1 %>%
  distinct(country, year) %>%
  count(year, name = "nn") %>% 
  filter(nn == max(nn)) %>% 
  pull(nn)

data_poorest <- dcpo_input_raw_pge1 %>%
  distinct(country, year, item) %>%
  count(country) %>%
  arrange(n) %>%
  filter(n == 2) %>%
  pull(country) %>% 
  knitr::combine_words()

wordify_numeral <- function(x) setNames(c("one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", " seventeen", "eighteen", "nineteen"), 1:19)[x]

n_data_poorest <- {data_poorest %>%
    str_split(",|(?<!, )and") %>% 
    first()} %>% 
  length() %>% 
  wordify_numeral()

(countries_plot + cby_plot) / (ybc_plot)
```

Consider the most frequently asked item in these data, which asks respondents whether they strongly agree, agree, disagree, or strongly disagree with the statement "On the whole, men make better political leaders than women do."
Employed by the Americas Barometer, the Arab Barometer, the Eurobarometer, the LatinobarÃ³metro, the Pew Research Center, and the World Values Survey, this question was asked in a total of `r polileader4_cy` different country-years.
That this constitutes only `r {polileader4_cy*100/(spanned_cy %>% str_replace(",", "") %>% as.numeric())} %>% round()`% of the country-years spanned by our data---and remember, this is the _most common_ survey item---again underscores just how sparse the available public opinion data is on this topic.

The upper left panel of Figure&nbsp;\ref{item_country_plots} shows the dozen countries with the highest count of country-year-item observations.
The United States, with `r us_obs` observations, is far and away the best represented country in the source data, followed by `r others`.
At the other end of the spectrum, `r n_data_poorest` countries---`r data_poorest`---have only the minimum two observations required to be included in the source dataset at all.
The upper right panel shows the twelve countries with the most years observed; this group is similar, but with `r adding` joining the list and `r dropping` dropping off.
The bottom panel counts the countries observed in each year and reveals just how few relevant survey items were asked before 1990.
Country coverage reached its peak in `r y_peak_year`, when respondents in `r y_peak_nn` countries were asked items about gender egalitarianism in the public sphere.
In the next section, we describe how we are able to make use of all of this sparse and incomparable survey data to generate complete, comparable time-series PGE scores using a latent variable model.

```{r dcpo_input_public}
dcpo_input_pge <- DCPOtools::format_dcpo(dcpo_input_raw_pge1,
                                              scale_q = "polileader4",
                                              scale_cp = 2)

save(dcpo_input_pge, file = here("paper", "measuring_egalitarianism", "data", "dcpo_input_pge.rda"))
```

## A Model of Public Gender Egalitarianism

There has been a recent blossoming of scholarship developing latent variable models of public opinion based on cross-national survey data [see @Claassen2019; @Caughey2019; @McGann2019; @Kolczynska2020].
To estimate public gender egalitarianism across countries and over time, we draw on the latest of these methods that is appropriate for data that is not only incomparable but also sparse, the Dynamic Comparative Public Opinion (DCPO) model presented in @Solt2020c.
The DCPO model is a population-level two-parameter ordinal logistic item response theory (IRT) model with country-specific item-bias terms.
For a detailed description of the DCPO model, see @Solt2020c [, 3-8]; here, we focus on how it deals with the principal issues raised by our source data, incomparability and sparsity.

The DCPO model accounts for the incomparability of different survey questions with two parameters.
First, it incorporates the _difficulty_ of each question's responses, that is, how much public gender egalitarianism is indicated by a given response. 
That each response evinces more or less of our latent trait is most easily seen with regard to the ordinal responses to the same question: strongly agreeing with the statement "both the husband and wife should contribute to household income," exhibits more public gender egalitarianism than responding "agree," which in turn is more egalitarian than responding "disagree," which is a more egalitarian response than "strongly disagree."
But this is also true across questions.
For example, strongly disagreeing that "on the whole, men make better business executives than women do" likely expresses even more egalitarianism than strongly agreeing merely that both spouses should have paying jobs.
Second, the DCPO model accounts for each question's _dispersion_, its noisiness with regard to our latent trait.
The lower a question's dispersion, the better that changes in responses to the question map onto changes in public gender egalitarianism.
Together, the model's difficulty and dispersion estimates work to generate comparable estimates of the latent variable of public gender egalitarianism from the available but incomparable source data.

To address the sparsity of the source data---the fact that there are gaps in the time series of each country, and even many observed country-years have only one or few observed items---DCPO uses local-level dynamic linear models, i.e., random-walk priors, for each country.
That is, within each country, each year's value of public gender egalitarianism is modeled as the previous year's estimate plus a random shock.
These dynamic models smooth the estimates of public gender egalitarianism over time and allow estimation even in years for which little or no survey data is available, albeit at the expense of greater measurement uncertainty.

```{r dcpo, eval=FALSE}
dcpo_input <- dcpo_input_pge

iter <- 1000
 
dcpo <- cmdstan_model("~/Documents/Projects/DCPO/inst/stan/dcpo.stan")

dcpo_output <- dcpo$sample(
   data = dcpo_input[1:13], 
   max_treedepth = 14,
   adapt_delta = 0.99,
   step_size = 0.005,
   seed = 324, 
   chains = 4, 
   parallel_chains = 4,
   iter_warmup = iter/2,
   iter_sampling = iter/2,
   refresh = iter/50
 )

results_path <- here::here(file.path("data", 
                                     iter, 
                                  {str_replace_all(Sys.time(),
                                                      "[- :]",
                                                   "") %>%
                                         str_replace("\\d{2}$",
                                                     "")}))

dir.create(results_path, 
           showWarnings = FALSE, 
           recursive = TRUE)

dcpo_output$save_data_file(dir = results_path,
                           random = FALSE)
dcpo_output$save_output_files(dir = results_path,
                              random = FALSE)

save(dcpo_input, file = here("paper", "measuring_egalitarianism", "data", "dcpo_input.rda"))
```

```{r dcpo_output, eval=FALSE}
 if (!exists("results_path")) {
   latest <- "202307061813"
   results_path <- here::here("data", "1000", latest)
   
   # Define OSF_PAT in .Renviron: https://docs.ropensci.org/osfr/articles/auth
   # if (!file.exists(file.path(results_path, paste0("dcpo-", latest, "-1.csv")))) {
   #   dir.create(results_path, showWarnings = FALSE, recursive = TRUE)
   #   osf_retrieve_node("9uvdk") %>% 
   #     osf_ls_files() %>% 
   #     filter(name == latest) %>% 
   #     osf_download(path = here::here("data", "1000"))
   # }
}
 
dcpo_output <- as_cmdstan_fit(here(results_path,
                                   list.files(results_path,
                                              pattern="csv$")))

load(here("paper", "measuring_egalitarianism", "data", "dcpo_input.rda"))

pge <- extract_dcpo_results(dcpo_input,
                            dcpo_output,
                            par = "theta") %>% 
  rename(pge = theta)

save(pge, file = here("data", "pge.rda"))

alpha_results <- summarize_dcpo_results(dcpo_input,
                                        dcpo_output = dcpo_output,
                                        pars = "alpha") %>% 
    transmute(item = question,
              dispersion = mean)

beta_results <- summarize_dcpo_results(dcpo_input,
                                       dcpo_output,
                                       "beta") %>% 
    group_by(question) %>% 
    summarize(difficulties0 = paste0(sprintf("%.2f", round(mean, 2)),
                                     collapse = ", ")) %>% 
    mutate(item = question,
           cp = if_else(str_detect(item, "threestate"),
                        2, 
                        as.numeric(str_extract(item, "\\d+")) - 1),
           term = str_glue("(( ?-?[0-9].[0-9][0-9]?,?){{{cp}}})"),
           difficulties = str_extract(difficulties0, 
                                      term) %>%
               str_replace(",$", "") %>% 
               str_trim()) %>% 
    transmute(item, difficulties)

save(alpha_results,
     beta_results,
     file = here::here("data",
                       "item_results.rda"))

pge_summary <- DCPOtools::summarize_dcpo_results(dcpo_input,
                                                 dcpo_output,
                                                 "theta",
                                                 probs = c(.025, 0.1,
                                                           0.9, .975)) %>% 
  select(country, year, 
         pge = mean, pge_se = sd,
         p2_5 = q2.5, p10 = q10, p90 = q90, p97_5 = q97.5) %>% 
  mutate(across(.cols = where(is.numeric),
                .fns = function(x) round(x, 3))) %>% 
  filter(!country == "Northern Ireland") %>% 
  mutate(world_region = countrycode(country,
                                    origin = "country.name.en",
                                    destination = "region8",
                                    custom_dict = region_dict))

save(pge_summary, file = here("data",
                              "pge_summary.rda"))
```

```{r pge_results_summary, cache=TRUE, cache.extra = tools::md5sum(here("paper", "measuring_egalitarianism", "data", "dcpo_output.rda"))}
load(here("paper", "measuring_egalitarianism", "data", "dcpo_input.rda"))
load(here("data", "pge.rda"))
load(here("data", "pge_summary.rda"))

pge_results <- pge %>% 
  split(pge$draw)

res_cy <- nrow(pge_summary) %>% 
  scales::comma()

res_c <- pge_summary %>% 
  pull(country) %>% 
  unique() %>% 
  length()
```

We estimated the model on our source data using the `DCPO` and `cmdstanr` packages for R [@Solt2020a; @Gabry2022], running four chains for 1,000 iterations each and discarding the first half as warmup, which left us with 2,000 samples.
All $\hat{R}$ diagnostics were below 1.02, indicating that the model converged.

The dispersion parameters of the survey items indicate that all of them load well on the latent variable (see Appendix A).
The result is estimates, in all `r res_cy` country-years spanned by the source data, of mean public gender egalitarianism, what we call PGE scores.


## Validation of the PGE Dataset

Before we can use the PGE scores to evaluate whether and to what extent that public gender egalitarianism contributes to women's descriptive representation and to gender egalitarian policy outcomes---and even before we put too much effort into examining how it varies around the world---we must assess the validity of these PGE scores.
That is, we must make certain that the PGE scores, as a measure, reflect the concept of the public's gender egalitarianism with regard to the public sphere of politics and the workforce.

Above, we discussed how we distinguished this concept from broader conceptions of gender egalitarianism.
Here, we first confirm that our refined concept of public gender egalitarianism is not itself multidimensional---that attitudes toward gender equality in politics do in fact hang together with attitudes toward gender equality in the workplace---a crucial first step in the validation of latent variable measures like the PGE dataset [see, e.g., @Hu2023].
We used the survey items listed in Appendix A to estimate two separate indices of gender egalitarianism in politics and in the workplace.  As shown in Figure \ref{pge_pwe_corr_plot}, these two indices both correlate very highly with the PGE scores and with each other, reinforcing the conclusion that public gender egalitarianism exists as a single dimension across countries and years.

```{r create_pwe_indices, cache=TRUE}
public_items <- read_csv(here::here("paper",
                                    "measuring_egalitarianism",
                                    "data-raw",
                                    "public_items.csv"),
                         col_types = "ccddd")

dcpo_input_political <- dcpo_input_raw_pge1 %>%
  inner_join(public_items, by = "item") %>% 
  filter(political==1) %>% 
  DCPOtools::format_dcpo(scale_q = "polileader4",
                         scale_cp = 2)

dcpo_input_workplace <- dcpo_input_raw_pge1 %>%
  inner_join(public_items, by = "item") %>%
  filter(workplace==1) %>% 
  DCPOtools::format_dcpo(scale_q = "job3a",
                         scale_cp = 2)
```

```{r dcpo_political, eval=FALSE}
iter <- 1000

dcpo_output_political <- dcpo$sample(
    data = dcpo_input_political[1:13], 
    max_treedepth = 14,
    adapt_delta = 0.99,
    step_size = 0.005,
    seed = 324, 
    chains = 4, 
    parallel_chains = 4,
    iter_warmup = iter/2,
    iter_sampling = iter/2,
    refresh = iter/50
)

results_path_political <- here::here(file.path("paper",
                                               "measuring_egalitarianism",
                                               "data", 
                                     paste0(iter, "_political"), 
                                     {str_replace_all(Sys.time(),
                                                      "[- :]",
                                                      "") %>%
                                             str_replace("\\d{2}$",
                                                         "")}))

dir.create(results_path_political, 
           showWarnings = FALSE, 
           recursive = TRUE)

dcpo_output_political$save_data_file(dir = results_path_political,
                                     random = FALSE)
dcpo_output_political$save_output_files(dir = results_path_political,
                                        random = FALSE)
```

```{r political, eval=FALSE}
if (!exists("results_path_political")) {
    latest <- "2023073009555"
    results_path <- here("paper",
                         "measuring_egalitarianism",
                         "data", "1000_political", latest)
    
    # Define OSF_PAT in .Renviron: https://docs.ropensci.org/osfr/articles/auth
    # if (!file.exists(file.path(results_path, paste0("dcpo-", latest, "-1.csv")))) {
    #   dir.create(results_path, showWarnings = FALSE, recursive = TRUE)
    #   osf_retrieve_node("9uvdk") %>% 
    #     osf_ls_files() %>% 
    #     filter(name == latest) %>% 
    #     osf_download(path = here::here("data", "1000"))
    # }
}

dcpo_output_political <- as_cmdstan_fit(here(results_path_political,
                                             list.files(results_path_political,
                                                        pattern="csv$")))

political <- extract_dcpo_results(dcpo_input_political,
                                  dcpo_output_political,
                                  par = "theta") %>% 
  rename(political = theta)

save(political, file = here("paper",
                            "measuring_egalitarianism",
                            "data", 
                            "political.rda"))

```

```{r dcpo_workplace, eval=FALSE}
iter <- 1500

dcpo_output_workplace <- dcpo$sample(
    data = dcpo_input_workplace[1:13], 
    max_treedepth = 14,
    adapt_delta = 0.99,
    step_size = 0.005,
    seed = 324, 
    chains = 4, 
    parallel_chains = 4,
    iter_warmup = iter/2,
    iter_sampling = iter/2,
    refresh = iter/50
)

results_path_workplace <- here::here(file.path("paper",
                                               "measuring_egalitarianism",
                                               "data", 
                                               paste0(iter, "_workplace"), 
                                               {str_replace_all(Sys.time(),
                                                                "[- :]",
                                                                "") %>%
                                                   str_replace("\\d{2}$",
                                                               "")}))

dir.create(results_path_workplace, 
           showWarnings = FALSE, 
           recursive = TRUE)

dcpo_output_workplace$save_data_file(dir = results_path_workplace,
                                     random = FALSE)
dcpo_output_workplace$save_output_files(dir = results_path_workplace,
                                        random = FALSE)
```

```{r workplace, eval=FALSE}
if (!exists("results_path_workplace")) {
    latest <- "20230730111113.642"
    results_path <- here("paper",
                         "measuring_egalitarianism",
                         "data", "1500_workplace", latest)
    
    # Define OSF_PAT in .Renviron: https://docs.ropensci.org/osfr/articles/auth
    # if (!file.exists(file.path(results_path, paste0("dcpo-", latest, "-1.csv")))) {
    #   dir.create(results_path, showWarnings = FALSE, recursive = TRUE)
    #   osf_retrieve_node("9uvdk") %>% 
    #     osf_ls_files() %>% 
    #     filter(name == latest) %>% 
    #     osf_download(path = here::here("data", "1000"))
    # }
}

dcpo_output_workplace <- as_cmdstan_fit(here(results_path_workplace,
                                             list.files(results_path_workplace,
                                                        pattern="csv$")))

workplace <- extract_dcpo_results(dcpo_input_workplace,
                                  dcpo_output_workplace,
                                  par = "theta") %>% 
  rename(workplace = theta)

save(workplace, file = here("paper",
                            "measuring_egalitarianism",
                            "data", 
                            "workplace.rda"))

```

```{r pge_pwe_corr, cache=TRUE}
load(here("paper",
          "measuring_egalitarianism",
          "data", 
          "political.rda"))

load(here("paper",
          "measuring_egalitarianism",
          "data", 
          "workplace.rda"))

pge_pw <- pge %>% 
  left_join(political, 
            by = join_by(country, year, draw)) %>% 
  left_join(workplace, 
            by = join_by(country, year, draw))

pge_political_cor <- pge_pw %>% 
  group_by(draw) %>% 
  summarize(corr = cor(pge, political, use = "pairwise.complete.obs")) %>% 
  pull(corr) %>% 
  mean() %>% 
  round(2)

pge_workplace_cor <- pge_pw %>% 
  group_by(draw) %>% 
  summarize(corr = cor(pge, workplace, use = "pairwise.complete.obs")) %>% 
  pull(corr) %>% 
  mean() %>% 
  round(2)

political_workplace_cor <- pge_pw %>% 
  group_by(draw) %>% 
  summarize(cor = cor(political, workplace, use = "pairwise.complete.obs")) %>% 
  pull(cor) %>% 
  mean() %>% 
  round(2)

pge_pwe_corr_matrix <- matrix(c(1, pge_political_cor, pge_workplace_cor,
                                pge_political_cor, 1, political_workplace_cor,
                                pge_workplace_cor, political_workplace_cor, 1),
                              ncol = 3)
colnames(pge_pwe_corr_matrix) <- c("Public\nGender\nEgalitarianism", "Political\nGender\nEgalitarianism", "Workplace\nGender\nEgalitarianism")
```

```{r pge_pwe_corr_plot, fig.height=4, fig.cap = "Pairwise Correlations Among PGE Index and Separate Political and Workplace Egalitarianism Indices  \\label{pge_pwe_corr_plot}"}
corrplot::corrplot.mixed(pge_pwe_corr_matrix, tl.col = "black", tl.cex = .8, upper = "ellipse", upper.col = COL1('Greys', 200), lower.col = COL1('Greys', 200), cl.lim = c(0,1))
```

```{r internal_plot, cache = TRUE}

internal_dat <- dcpo_input$data %>% 
  filter(item == "polileader4 3 or higher") %>% 
  mutate(prop = 1 - y_r/n_r,
         se = sqrt((prop*(1-prop))/n),
         prop_90 = prop + qnorm(.9)*se,
         prop_10 = prop - qnorm(.9)*se) %>% 
  left_join(pge_summary, by = c("country", "year"))

pge_polileader <- pge_results %>% 
  map(. %>% right_join(dcpo_input$data %>% 
                         filter(item == "polileader4 3 or higher") %>% 
                         rowwise() %>% 
                         transmute(country = country,
                                   year = year,
                                   prop = 1 - y_r/n_r,
                                   se = sqrt((prop*(1-prop))/n),
                                   polileader = rnorm(1, mean = prop, sd = se)), 
                       by = c("country", "year")))

internal_cor <- map(pge_polileader, function(x) with(x, cor(pge, polileader))) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  paste0("R = ", .)

internal_label <- tibble(pge = .78, prop = .99, label = internal_cor)

internal_plot <- internal_dat %>% 
  ggplot(aes(x = pge,
             y = prop * 100)) +
  geom_segment(aes(x = p10, xend = p90,
                   y = prop * 100, yend = prop * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_segment(aes(x = pge, xend = pge,
                   y = prop_90 * 100, yend = prop_10 * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  coord_cartesian(ylim=c(0,100)) +
  scale_x_continuous(breaks=seq(.1, .9, 0.2)) +
  labs(x = "PGE Score", 
       y = '% Agreeing That "On the Whole, Men\nMake Better Political Leaders than Women Do"') + 
  ggtitle("All Country-Years") +
  geom_label(data = internal_label, aes(label = label), size = 3)
```

```{r internal_cs_plot, cache=TRUE}
## Cross-sectional
internal_poliequal <- dcpo_input$data %>% 
  filter(item == "poliequal3 2 or higher" & year == 2007) %>% 
  mutate(iso2c = countrycode::countrycode(country,
                                          origin = "country.name",
                                          destination = "iso2c"),
         prop = 1 - y_r/n_r,
         se = sqrt((prop*(1-prop))/n),
         prop_90 = prop + qnorm(.9)*se,
         prop_10 = prop - qnorm(.9)*se) %>% 
  left_join(pge_summary, by = c("country", "year"))

pge_poliequal <- pge_results %>% 
  map(. %>% right_join(dcpo_input$data %>% 
                         filter(item == "poliequal3 2 or higher" & year == 2007) %>% 
                         rowwise() %>% 
                         transmute(country = country,
                                   year = year,
                                   prop = 1 - y_r/n_r,
                                   se = sqrt((prop*(1-prop))/n),
                                   poliequal = rnorm(1, mean = prop, sd = se)), 
                       by = c("country", "year")))

internal_cs_cor <- map(pge_poliequal, 
                       function(x) with(x, cor(pge, poliequal))) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  paste0("R = ", .)

internal_cs_label <- tibble(pge = .7, prop = .73, label = internal_cs_cor)

internal_cs_plot <- internal_poliequal %>% 
  ggplot(aes(x = pge,
             y = prop * 100)) +
  geom_segment(aes(x = p10, xend = p90,
                   y = prop * 100, yend = prop * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_segment(aes(x = pge, xend = pge,
                   y = prop_90 * 100, yend = prop_10 * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_text(aes(label = iso2c), size = 2) +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  labs(x = "PGE Score", 
       y = '% Opining That "Men Generally Make\nBetter Political Leaders Than Women"') + 
  ggtitle("Pew Global Spring 2007") +
  geom_label(data = internal_cs_label, aes(label = label), size = 3)
```

```{r internal_us_plot, cache=TRUE}
# Longitudinal
internal_us <- dcpo_input$data %>% 
  filter(item == "emopoli2 2 or higher") %>% 
  mutate(prop = y_r/n_r,
         se = sqrt((prop*(1-prop))/n),
         prop_90 = prop + qnorm(.9)*se,
         prop_10 = prop - qnorm(.9)*se) %>% 
  right_join(pge_summary %>% 
               filter(country == "United States"),
             by = c("country", "year"))

pge_emopoli <- pge_results %>% 
  map(. %>% right_join(dcpo_input$data %>% 
                         filter(item == "emopoli2 2 or higher") %>% 
                         rowwise() %>% 
                         transmute(country = country,
                                   year = year,
                                   prop = y_r/n_r,
                                   se = sqrt((prop*(1-prop))/n),
                                   emopoli = rnorm(1, mean = prop, sd = se)), 
                       by = c("country", "year")))

internal_us_cor <- map(pge_emopoli, function(x) with(x, cor(pge, emopoli))) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  paste0("R = ", .)

internal_us_label <- tibble(year = 1980, pge = .87, label = internal_us_cor)

internal_us_plot <- internal_us %>% 
  ggplot(aes(x = year,
             y = pge)) +
  geom_line() +
  geom_ribbon(aes(ymin = p10,
                  ymax = p90,
                  linetype = NA),
              alpha = .2) +
  geom_point(aes(y = prop),
             fill = "black",
             shape = 21,
             size = .5,
             na.rm = TRUE) +
  geom_path(aes(y = prop),
            linetype = 3,
            na.rm = TRUE,
            alpha = .7) +
  geom_segment(aes(x = year, xend = year,
                   y = prop_90, yend = prop_10),
               na.rm = TRUE,
               alpha = .2) +
  annotate("text", x = 1979, y = .7, size = 2,
           label = 'U.S. GSS') +
  annotate("text", x = 2012, y = .60, size = 2,
           label = "PGE") +
  labs(x = "Year", 
       y = "Score") +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ggtitle("United States") +
  geom_label(data = internal_us_label, aes(label = label), size = 3)
```

```{r convergent, cache = TRUE, cache.extra = tools::md5sum(here("paper", "measuring_egalitarianism", "data", "pge.rda")), fig.cap="Convergent Validation: Correlations Between PGE Scores and Individual PGE Source Data Survey Items \\label{conv_plot}", fig.height=4}

internal_plot + internal_cs_plot + internal_us_plot +
  plot_annotation(caption = "Note: Gray whiskers and shading represent 80% credible intervals.")
```


Like @Caughey2019 [684-685], we provide evidence of the measure's validity with convergent validation and construct validation.
Convergent validation refers to showing that a measure is empirically associated with alternative indicators of the same concept [@Adcock2001, 540].
Here, we compare PGE scores to responses to individual source-data survey items that were used to generate our estimates, that is, we provide an 'internal' validation test [see, e.g., @Caughey2019, 689; @Solt2020c, 10].
In the left panel of Figure&nbsp;\ref{conv_plot}, we examine the four-point question on political leaders mentioned above, the most common item in the source data across all country-years.
Then, in the center panel, we look at the question that provides the most data-rich cross-section in the source data, which asked whether respondents felt "men generally make better political leaders than women" and was included in Pew Global's Spring 2007 survey.
Finally, in the right panel, to evaluate how well the PGE scores capture change over time, we focus on the item with the largest number of observations for a single country in the source data, which asked respondents to the U.S. General Social Survey whether they agreed or disagreed that "most men are better suited emotionally for politics than are most women."
In every case, the correlations---estimated taking into account the uncertainty in the measures---are in the expected direction and very strong.^[
The uncertainty in the PGE score and in the percentage in the population who would agree with the item does not substantially affect the correlation with the political leadership question, but failing to account for this uncertainty would overstate the correlation with the Pew item, at $R =$ `r with(internal_poliequal, cor(prop, pge)) %>% round(2)`, and the U.S. GSS item, at $R =$ `r with(internal_us, cor(prop, pge, use = "pairwise.complete.obs")) %>% round(2)`.
We take up the issue of the importance of taking uncertainty into account when working with the PGE data in a subsequent section.]

```{r construct_validation_survey, cache = TRUE, cache.extra = tools::md5sum(here("paper", "measuring_egalitarianism", "data", "pge.rda")), fig.cap="Construct Validation: Correlations Between PGE Scores and Individual 'Balancing' Gender Egalitarianism Survey Items \\label{surv_const_plot}", fig.height=4}
dcpo_input_balance <- DCPOtools::format_dcpo(dcpo_input_raw_balance1,
                                             scale_q = "familywoman4",
                                             scale_cp = 2)

wantch <- dcpo_input_balance$data %>% 
  filter(item == "wantch4 3 or higher") %>% 
  mutate(iso2c = countrycode::countrycode(country,
                                          origin = "country.name",
                                          destination = "iso2c"),
         prop = 1 - y_r/n_r,
         se = sqrt((prop*(1-prop))/n),
         prop_90 = prop + qnorm(.9)*se,
         prop_10 = prop - qnorm(.9)*se) %>% 
  left_join(pge_summary, by = c("country", "year"))

pge_wantch <- pge_results %>% 
  map(. %>% right_join(wantch %>% 
                         rowwise() %>% 
                         transmute(country = country,
                                   year = year,
                                   prop = 1 - y_r/n_r,
                                   se = sqrt((prop*(1-prop))/n),
                                   wantch = rnorm(1, mean = prop, sd = se)), 
                       by = c("country", "year")))

wantch_cor <- map(pge_wantch, function(x) 
  with(x, cor(pge, wantch))) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  paste0("R = ", .)

wantch_label <- tibble(pge = .76, prop = .97, label = wantch_cor)

wantch_plot <- wantch %>% 
  ggplot(aes(x = pge,
             y = prop * 100)) +
  geom_segment(aes(x = p10, xend = p90,
                   y = prop * 100, yend = prop * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_segment(aes(x = pge, xend = pge,
                   y = prop_90 * 100, yend = prop_10 * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  coord_cartesian(ylim=c(0,100)) +
  labs(x = "PGE Score", 
       y = '% Agreeing That "A Job is Alright But What\nMost Women Really Want is a Home and Children"') + 
  ggtitle("All Country-Years") +
  geom_label(data = wantch_label, aes(label = label), size = 3)

# cross-section
familywoman <- dcpo_input_balance$data %>% 
  filter(item == "familywoman4 3 or higher") %>% 
  mutate(iso2c = countrycode::countrycode(country,
                                          origin = "country.name",
                                          destination = "iso2c"),
         prop = 1 - y_r/n_r,
         se = sqrt((prop*(1-prop))/n),
         prop_90 = prop + qnorm(.9)*se,
         prop_10 = prop - qnorm(.9)*se) %>% 
  left_join(pge_summary, by = c("country", "year"))

pge_familywoman <- pge_results %>% 
  map(. %>% right_join(familywoman %>% 
                         rowwise() %>% 
                         transmute(country = country,
                                   year = year,
                                   prop = 1 - y_r/n_r,
                                   se = sqrt((prop*(1-prop))/n),
                                   familywoman = rnorm(1, mean = prop, sd = se)), 
                       by = c("country", "year")))

familywoman_cor <- map(pge_familywoman, function(x) 
  with(x, cor(pge, familywoman))) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  paste0("R = ", .)

familywoman_label <- tibble(pge = .8, prop = .97, label = familywoman_cor)

familywoman_plot <- familywoman %>% 
  ggplot(aes(x = pge,
             y = prop * 100)) +
  geom_segment(aes(x = p10, xend = p90,
                   y = prop * 100, yend = prop * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_segment(aes(x = pge, xend = pge,
                   y = prop_90 * 100, yend = prop_10 * 100),
               na.rm = TRUE,
               alpha = .2) +
  geom_text(aes(label = iso2c), size = 2) +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  coord_cartesian(ylim=c(0,100)) +
  labs(x = "PGE Score", 
       y = '% Agreeing That "The Most Important Role of a\nWoman is to Take Care of Her Home and Family"') + 
  ggtitle("Eurobarometer 87.4") +
  geom_label(data = familywoman_label, aes(label = label), size = 3)

# time series
psw_de <- dcpo_input_balance$data %>% 
  filter(item == "preschoolwork4 3 or higher" & country == "Germany") %>% 
  mutate(prop = y_r/n_r,
         se = sqrt((prop*(1-prop))/n),
         prop_90 = prop + qnorm(.9)*se,
         prop_10 = prop - qnorm(.9)*se) %>% 
  right_join(pge_summary %>%
               filter(country == "Germany"),
             by = c("country", "year"))

pge_de <- pge_results %>% 
  map(. %>% right_join(psw_de %>% 
                         rowwise() %>% 
                         transmute(country = country,
                                   year = year,
                                   prop = y_r/n_r,
                                   se = sqrt((prop*(1-prop))/n),
                                   var = rnorm(1, mean = prop, sd = se)), 
                       by = c("country", "year")))

psw_de_cor <- map(pge_de, function(x) 
  with(x, cor(pge, var, use = "pairwise.complete.obs"))) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  paste0("R = ", .)

psw_de_label <- tibble(year = 1990, pge = .8, label = psw_de_cor)

psw_de_plot <- psw_de %>% 
  ggplot(aes(x = year,
             y = pge)) +
  geom_line() +
  geom_ribbon(aes(ymin = p10,
                  ymax = p90,
                  linetype = NA),
              alpha = .2) +
  geom_point(aes(y = prop),
             fill = "black",
             shape = 21,
             size = .5,
             na.rm = TRUE) +
  geom_path(aes(y = prop),
            linetype = 3,
            na.rm = TRUE,
            alpha = .7) +
  geom_segment(aes(x = year, xend = year,
                   y = prop_90, yend = prop_10),
               na.rm = TRUE,
               alpha = .2) +
  annotate("text", x = 2010, y = .30, size = 2,
           label = 'ALLBUS, EVS, WVS') +
  annotate("text", x = 1986, y = .7, size = 2,
           label = "PGE") +
  labs(x = "Year", 
       y = "Score") +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ggtitle("Germany") +
  geom_label(data = psw_de_label, aes(label = label), size = 3)


wantch_plot + familywoman_plot + psw_de_plot +
  plot_annotation(caption = "Note: Gray whiskers and shading represent 80% credible intervals.")
```

We continue, then, to construct validation, which refers to demonstrating, for some _other_ concept believed causally related to the concept a measure seeks to represent, that the measure is empirically associated with measures of that other concept [@Adcock2001, 542].
In Figure&nbsp;\ref{surv_const_plot}, we look to individual survey items not included in our source data but tapping a related category of gender egalitarianism, namely questions that ask how women should balance opportunities in the public sphere with their traditional duties in the private sphere.
Assuming that attitudes that women should prioritize housework and childcare over paid employment and politics---or convictions that there will be negative consequences if they do not---will lead to less gender egalitarian opinions with regard to these latter, public-sphere activities, evidence for this theoretical relationship will provide construct validation for the PGE scores.
Exemplars of such items across all available country-years ("a job is alright but what most women really want is a home and children" from the WVS and EVS), in cross-section ("the most important role of a woman is to take care of her home and family" from the Eurobarometer 87.4), and in time series ("a pre-school child is likely to suffer if his or her mother works" from the German ALLBUS, WVS, and EVS) all show strong correlations with the PGE scores.

```{r cons_valid}

# https://genderstats.un.org/#/downloads
lfpr_un <- read_csv(here("paper", "measuring_egalitarianism", "data", "3b - Labour force participation rate for persons aged 15+  by sex_data.csv"), skip = 1, col_types = "ccdcdcdccccccdddcc") %>% 
  select(Country, Year, Sex, Value) %>% 
  pivot_wider(names_from = Sex,
              values_from = Value) %>% 
  transmute(country = countrycode::countrycode(Country, 
                                               origin = "country.name",
                                               destination = "country.name"),
            iso2c = countrycode::countrycode(country,
                                             origin = "country.name",
                                             destination = "iso2c"),
            year = Year,
            flfpr = Female,
            f2m_ratio = round(Female/Male*100, 2)) %>% 
  filter(!is.na(country) & !is.na(flfpr)) %>% 
  left_join(pge_summary, by = c("country", "year")) %>% 
  filter(!is.na(pge))

pge_lfpr <- pge_results %>% 
  map(. %>% right_join(lfpr_un %>% 
                         select(-pge), 
                       by = c("country", "year")))

lfpr_cor <- map(pge_lfpr, function(x) {
  x %>% 
    filter(year == 2017) %>% 
    with(cor(pge, f2m_ratio, use = "pairwise.complete.obs"))
}) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  paste0("R = ", .)

lfpr_label <- tibble(pge = .15, f2m_ratio = 90, label = lfpr_cor)

# https://stats.oecd.org/index.aspx?queryid=54753
# rsdmx::readSDMX("https://stats.oecd.org/restsdmx/sdmx.ashx/GetData/GENDER_EMP/.EMP11.WOMEN.TOTAL.2017/all?") %>% 
#  as_tibble() %>%
#  write_csv("paper/measuring_egalitarianism/data/directors.csv")
directors <- read_csv(here("paper",
                           "measuring_egalitarianism",
                           "data",
                           "directors.csv"),
                      col_types = "ccccdcdd") %>% 
  transmute(country = countrycode::countrycode(COU, "iso3c", "country.name"),
            iso2c = countrycode::countrycode(country,
                                             origin = "country.name",
                                             destination = "iso2c"),
            year = as.numeric(TIME),
            directors = obsValue) %>% 
  filter(!is.na(country)) %>% 
  inner_join(pge_summary, by = c("country", "year"))

directors_cor <- map(pge_results, function(x) {
  x %>% 
    inner_join(directors %>% select(country, year, directors),
               by = c("country", "year")) %>% 
    with(cor(pge, directors))
}) %>% 
  unlist() %>% 
  mean() %>% 
  round(2) %>% 
  sprintf("%.2f", .) %>% 
  paste0("R = ", .)

directors_label <- tibble(pge = .37, directors = 40, label = directors_cor)

lfpr_plot <- ggplot(lfpr_un %>% filter(year==2017),
                    aes(x = pge,
                        y = f2m_ratio)) +
  geom_segment(aes(x = p10, xend = p90,
                   y = f2m_ratio, yend = f2m_ratio),
               na.rm = TRUE,
               alpha = .2) +
  geom_text(aes(label = iso2c), size = 2) +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_bw() + theme(legend.position="none",
                     axis.text  = element_text(size=8),
                     axis.title = element_text(size=9)) +
  coord_cartesian(xlim=c(0, 1)) +
  labs(x = "Public Gender Egalitarianism, 2017", y = "Female to Male Labor Force Participation Ratio, 2017") +
  geom_label(data = lfpr_label, aes(label = label))

dir_plot <- ggplot(directors,
                   aes(x = pge,
                       y = directors)) +
  geom_segment(aes(x = p10, xend = p90,
                   y = directors, yend = directors),
               na.rm = TRUE,
               alpha = .2) +
  geom_text(aes(label = iso2c), size = 2) +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_bw() + theme(legend.position="none",
                     axis.text  = element_text(size=8),
                     axis.title = element_text(size=9)) +
  coord_cartesian(xlim=c(.2, 1)) +
  labs(x = "Public Gender Egalitarianism, 2017", y = "% Women, Boards of Directors of the \n Largest Publicly Listed Companies, 2017") +
  geom_label(data = directors_label, aes(label = label))
```

```{r cons_valid_plot, fig.cap="Construct Validation: Correlations Between PGE Scores and Indicators of Workplace Gender Equality \\label{construct_plot}", fig.height=4}
lfpr_plot + dir_plot +
  plot_annotation(caption = "Note: Gray whiskers represent 80% credible intervals.")

```

Finally, Figure&nbsp;\ref{construct_plot} shows additional tests of construct validation.
As attitudes toward gender egalitarianism in the public sphere plausibly both cause and are caused by women's gains in the workplace, strong relationships between the PGE scores and measures of workplace gender equality provide construct validation for our measure.
In the left panel of Figure&nbsp;\ref{construct_plot}, we compare the PGE scores to the ratio of women's to men's labor force participation rates in `r nrow(lfpr_un %>% filter(year == 2017))` countries in 2017, drawing on data compiled by the Statistics Division of the UN Department of Economic and Social Affairs [-@UNDESA2020].
In the right panel, we plot the PGE scores against the percentage of women on the boards of directors of the largest publicly listed companies in `r nrow(directors)` countries, also in 2017 [see @OECD2020].
Both correlations are strong.
Together, this evidence of construct validation and convergent validation attests to the validity of the PGE scores as measures of public opinion towards gender equality in the public sphere.

## Public Gender Egalitarianism Around the World
Attitudes toward gender equality in the public sphere vary greatly across countries.
Figure&nbsp;\ref{world_map} and Figure&nbsp;\ref{cs_mry} display the most recent available PGE score for each of the `r res_c` countries and territories in the dataset.
Together, they underscore the geographic breadth of the PGE dataset, which allows the study of countries and regions too often neglected in political science research [see @Wilson2022].

```{r world_map, fig.cap="PGE Scores Around the World \\label{world_map}", fig.height = 6}
world1 <- rnaturalearth::ne_countries(scale = "small", returnclass = "sf") %>%
    filter(!admin == "Antarctica")

pge_range <- c(.15, .95)
na_value = "white"
central_asia <- c("Armenia", "Azerbaijan", "Georgia", "Kazakhstan", "Kyrgyzstan", "Russia", "Tajikistan", "Turkmenistan", "Uzbekistan")

region_dict <- codelist %>% 
    mutate(region8 = case_when(region == "Europe & Central Asia" &
                                   country.name.en %in% central_asia ~
                                   "Central Asia",
                               region == "Europe & Central Asia" &
                                   !country.name.en %in% central_asia ~ "Europe",
                               TRUE ~ region)) %>% 
    select(country.name.en, region8) %>% 
    add_row(country.name.en = "Northern Ireland", region8 = "Europe")

region_pge <- pge_summary %>%
  group_by(country) %>%
  top_n(1, year) %>%
  ungroup() %>%
  select(country, pge, world_region) %>%
  group_by(world_region) %>%
  summarize(n_countries = n())

world_geom <- world1 %>% 
    mutate(country = countrycode::countrycode(admin,
                                              "country.name",
                                              "country.name"),
           world_region = countrycode(country,
                                      "country.name.en",
                                      "region8",
                                      custom_dict = region_dict)) %>% 
    filter(!admin == "Antarctica") %>% 
    left_join(pge_summary %>%
                  group_by(country) %>%
                  top_n(1, year) %>%
                  ungroup() %>%
                  select(country, pge),
              by = "country") %>% 
    arrange(-pge) %>% 
    left_join(region_pge,
              by = "world_region") %>% 
    mutate(world_region = fct_reorder(world_region,
                                      -n_countries,
                                      .na_rm = FALSE))

ggplot() +
    geom_sf(data = world1) +
    geom_sf(data = world_geom,
            aes(fill = pge, color = 'NA')) +
    coord_sf(crs = sf::st_crs("ESRI:53035")) +
    scale_fill_gradient(name = "Public\nGender\nEgalitarianism",
                        low = "grey95",
                        high = "grey5",
                        na.value = na_value,
                        limits = pge_range) +
    scale_color_manual(name = "", 
                       values = 'black',
                       labels = 'No Data') +
    guides(color = guide_legend(override.aes = 
                                    list(fill = na_value))) +
    theme(legend.position="right")

```

```{r cs_mry, fig.cap="PGE Scores, Most Recent Available Year \\label{cs_mry}", fig.height=10, fig.width=8}

n_panes <- 2
axis_text_size <- 10
p1_data <- pge_summary %>%
  group_by(country) %>%
  top_n(1, year) %>%
  ungroup() %>%
  arrange(pge) %>%
  transmute(country_year = paste0(country, " (", year, ")") %>% 
              str_replace("â€™", "'"),
            pge,
            conf.high = p90,
            conf.low = p10,
            pane = n_panes - (ntile(pge, n_panes) - 1),
            ranked = as.factor(ceiling(row_number())))

p_theta <- ggplot(p1_data,
                  aes(x = pge, y = ranked)) +
  geom_segment(aes(x = conf.low, xend = conf.high,
                   y = ranked, yend = ranked),
               na.rm = TRUE,
               alpha = .4) +
  geom_point(fill = "black", shape = 21, size = .5, na.rm = TRUE) +
  theme_bw() + theme(legend.position="none",
                     axis.text.x  = element_text(size = axis_text_size,
                                                 angle = 90,
                                                 vjust = .45,
                                                 hjust = .95),
                     axis.text.y  = element_text(size = axis_text_size),
                     axis.title = element_blank(),
                     strip.background = element_blank(), 
                     strip.text = element_blank(),
                     panel.grid.major = element_line(linewidth = .3),
                     panel.grid.minor = element_line(linewidth = .15)) +
  scale_y_discrete(breaks = p1_data$ranked, labels=p1_data$country_year) +
  coord_cartesian(xlim=c(0, 1)) +
  facet_wrap(vars(pane), scales = "free", nrow = 1)


p_theta +
  plot_annotation(caption = "Note: Gray whiskers represent 80% credible intervals.")

bottom5 <- p1_data %>% 
  arrange(ranked) %>% 
  slice(1:5) %>% 
  pull(country_year) %>% 
  str_replace(" \\(.*", "") %>% 
  str_replace("Palestinian", "the Palestinian") %>% 
  knitr::combine_words()
```

Figure&nbsp;\ref{cs_mry} shows that the Scandinavian countries and Germany are at the top of this list, along with Puerto Rico, which has had women of both of its major parties serve as chief executive and as recently as 2020 had a woman from each party holding the two most prominent elected offices on the island.
The latest scores for `r bottom5` have them as the places where public opinion is least favorable to gender equality in the public sphere.
The PGE scores vary considerably across countries.
Next, we examine this variation more closely in each of the world's regions.

```{r region_maps}
regions_geom <- world_geom %>% 
    split(., .$world_region)

regions_bbox <- map_df(regions_geom,
                    \(reg){
                        reg %>% 
                            summarize(ee_geom = st_transform(geometry,
                                                             crs = "ESRI:53035"),
                                      reg_xmin = ee_geom %>%
                                          sf::st_bbox() %>% 
                                          first() %>% 
                                          min(),
                                      reg_xmax = ee_geom %>% 
                                          sf::st_bbox() %>% 
                                          nth(3) %>% 
                                          max(),
                                      reg_ymin = ee_geom %>%
                                          sf::st_bbox() %>% 
                                          nth(2) %>% 
                                          min(),
                                      reg_ymax = ee_geom %>% 
                                          sf::st_bbox() %>% 
                                          nth(4) %>% 
                                          max(),
                                      .by = world_region) %>% 
                            as_data_frame() %>% 
                            select(-ee_geom) %>% 
                            distinct()
                    }) %>% 
    mutate(reg_xmin = case_when(world_region == "Europe" ~ -1700000,
                                world_region == "East Asia & Pacific" ~ 6200000,
                                world_region == "Central Asia" ~1850000,
                                TRUE ~ reg_xmin),
           reg_xmax = case_when(world_region == "North America" ~ -4000000,
                                TRUE ~ reg_xmax),
           reg_ymin = case_when(world_region == "Europe" ~ 4250000,
                                TRUE ~ reg_ymin))

region_maps <- map(regions_bbox$world_region,
                   \(reg) {
                     ggplot() +
                       geom_sf(data = world1,
                               fill = "grey97") +
                       geom_sf(data = regions_geom[[reg]],
                               aes(fill = pge, color = 'NA')) +
                       # geom_sf_label(data = regions_geom[[reg]],
                       #              aes(label = country),
                       #              size = 2) +
                       coord_sf(crs = sf::st_crs("ESRI:53035"),
                                xlim = c(regions_bbox %>% 
                                           filter(world_region == reg) %>% 
                                           pull(reg_xmin),
                                         regions_bbox %>% 
                                           filter(world_region == reg) %>% 
                                           pull(reg_xmax)),
                                ylim = c(regions_bbox %>% 
                                           filter(world_region == reg) %>% 
                                           pull(reg_ymin),
                                         regions_bbox %>% 
                                           filter(world_region == reg) %>% 
                                           pull(reg_ymax)),
                                expand = FALSE) +
                     scale_fill_gradient(name = "Public\nGender\nEgalitarianism",
                                         low = "grey95",
                                         high = "grey5",
                                         na.value = na_value,
                                         limits = pge_range) +
                       scale_color_manual(name = element_blank(), 
                                          values = 'black',
                                          labels = 'No Data') +
                       guides(color = guide_legend(override.aes = 
                                                     list(fill = na_value))) +
                       theme(legend.spacing.y = unit(0.7, "mm"),
                             panel.border = element_rect(colour = "black",
                                                         fill = NA),
                             legend.background = element_blank(),
                             legend.box.background = element_rect(
                               colour = "black",
                               fill = "white"))
                   })
```

```{r region_countries_pge}
region_countries_pge_summary <- pge_summary %>% 
  left_join(region_pge,
            by = "world_region") %>% 
  mutate(world_region = fct_reorder(world_region,
                                      -n_countries,
                                      .na_rm = FALSE)) %>% 
  split(., .$world_region) %>% 
  map(\(reg) {
    reg %>%
      group_by(country) %>% 
      mutate(pge_mry = last(pge)) %>% 
      ungroup() %>% 
      mutate(country = country %>% 
               str_replace("(.*) ", "\\1\n") %>% 
               str_replace(" SAR\n", "\nSAR ") %>% 
               factor() %>%
             fct_reorder(-pge_mry))
  })

note <- plot_annotation(caption = "Note: Countries are ordered by their PGE scores in their most recent\navailable year; gray shading and whiskers represent 80% credible intervals.")
```

```{r region_countries_pge_list}
region_pge_list <- pge %>%
  mutate(world_region = countrycode(country,
                                    "country.name.en",
                                    "region8",
                                    custom_dict = region_dict)) %>%
  left_join(region_pge,
            by = "world_region") %>% 
  mutate(world_region = fct_reorder(world_region,
                                    -n_countries,
                                    .na_rm = FALSE)) %>% 
  filter(!country == "Northern Ireland") %>% 
  group_by(country) %>% 
  mutate(pge_mry = last(pge)) %>% 
  ungroup() %>% 
  split(., .$world_region) 

region_countries_pge_list <- region_pge_list %>% 
  map(\(reg) 
      reg %>% 
        mutate(country = factor(country) %>%
                 fct_reorder(-pge_mry)) %>%   
        split(., .$country))
```

```{r trends}
trends <- pge_summary %>%
    group_by(country) %>% 
    summarize(pge_min = min(pge),
              pge_se_min = mean(ifelse(pge == pge_min, pge_se, NA_integer_),
                                na.rm = TRUE),
              pge_max = max(pge),
              pge_se_max = mean(ifelse(pge == pge_max, pge_se, NA_integer_),
                                na.rm = TRUE),
              pge_last = mean(ifelse(year == max(year), pge, NA_real_),
                              na.rm = TRUE),
              pge_se_last = mean(ifelse(pge == pge_last, pge_se, NA_integer_),
                                na.rm = TRUE),
              pge_first = mean(ifelse(year == min(year), pge, NA_real_),
                              na.rm = TRUE),
              pge_se_first = mean(ifelse(pge == pge_first, pge_se, NA_integer_),
                                 na.rm = TRUE),
              yr_min = mean(ifelse(pge == pge_min, year, NA_integer_),
                            na.rm = TRUE),
              yr_max = mean(ifelse(pge == pge_max, year, NA_integer_),
                            na.rm = TRUE),
              yr_last = max(year),
              yr_first = min(year),
              pge_gain = ifelse(yr_max > yr_min, pge_max - pge_min, pge_min - pge_max),
              pge_gain_se = sqrt(pge_se_max^2 + pge_se_min^2),
              pge_change = ifelse(yr_last > yr_first, pge_last - pge_first, pge_first - pge_last),
              pge_change_se = sqrt(pge_se_last^2 + pge_se_min^2),
              world_region = first(world_region)) %>% 
  arrange(world_region, -pge_change) %>% 
  filter(!country == "Malta") %>% 
  mutate(country = as_factor(country))

change_plot <- function(region, axis_text_size = 7) {
  trends %>% 
    filter(world_region == region) %>% 
    ggplot(aes(x = pge_change, y = country)) +
  geom_segment(aes(x = pge_change - qnorm(.9)*pge_change_se,
                   xend = pge_change + qnorm(.9)*pge_change_se,
                   y = country,
                   yend = country),
               na.rm = TRUE,
               alpha = .4) +
    geom_vline(xintercept = 0,
               linetype = "dashed",
               alpha = .25) +
  geom_point(fill = "black", shape = 21, size = .5, na.rm = TRUE) +
    theme_bw() + 
    theme(legend.position="none",
          axis.text.x  = element_text(size = axis_text_size,
                                      angle = 90,
                                      vjust = .45,
                                      hjust = .95),
          axis.text.y  = element_text(size = axis_text_size),
          axis.title = element_blank(),
          strip.background = element_blank(), 
          strip.text = element_blank(),
          panel.grid.major = element_line(linewidth = .3),
          panel.grid.minor = element_line(linewidth = .15),
          plot.title = element_text(size=8)) +
    scale_y_discrete(limits = rev,
                     position = "right") +
    ggtitle("Change in PGE,\nFirst to Last Observed Year")
}

```

\pagebreak
\newpage
### Europe
We turn first to Europe, the region with the largest number of countries in the PGE database.
Figure&nbsp;\ref{europe_map} depicts how the point estimates of the most recent PGE score for each country vary across the region.
The map reinforces that the public in many northern and western European countries have some of the most egalitarian views toward women in politics and the workforce in the world.
Led by Norway, Sweden, and Denmark, nearly all of these countries have PGE scores of .75 or higher in the most recent available year.
Gender egalitarianism tends to be lower in the countries to the east and southeast.
The lowest levels of gender egalitarianism in Europe were observed in Ukraine, Slovakia, and Moldova.
It should be noted, however, that the point estimates of the most recent available PGE scores in even these latter countries still attained or approached .5, indicating that roughly half the population holds egalitarian views. 
Gender egalitarianism is generally a widely held attitude among European publics.

\pagebreak
```{r europe_map, fig.cap="PGE Scores Across Europe, Most Recent Available Year \\label{europe_map}", fig.height = 5}
region_maps[[1]] +
  theme(legend.position = c(.99, .99),
        legend.justification = c(1, 1))
```

Figure&nbsp;\ref{europe_ts} displays how PGE scores have changed over time in the forty European countries for which estimates are available.
The biggest changes in gender egalitarianism over the observed years occurred in Estonia, Germany, and the Benelux countries of Belgium, the Netherlands, and Luxembourg.
The PGE scores in each of those countries were estimated to have increased by 30% or more of the measure's theoretical range.
On the other hand, shifts over time in the public's views toward gender equality were indiscernible in Moldova, Greece, Bosnia and Herzegovina, and North Macedonia.
Although some temporary declines are easily seen in this figure, and egalitarianism dips recently in a few, none of the countries of Europe exhibited lower levels of public gender egalitarianism in the most recent observed year than in their first observed year.

```{r europe_ts, fig.cap="PGE Scores in Europe Over Time \\label{europe_ts}", fig.height = 9, fig.width=7, cache=FALSE}
ts_plot <- function(data,
                    facet_text_size = 7,
                    ...) {
  ggplot(data = data, aes(x = year, y = pge)) +
    theme_bw() +
    theme(legend.position = "none") +
    coord_cartesian(xlim = c(1980, 2022), ylim = c(0, 1)) +
    labs(x = NULL, y = "PGE Scores") +
    geom_ribbon(data = data, 
                aes(ymin = p10, ymax = p90, linetype=NA),
                alpha = .25) +
    geom_line(data = data) +
    facet_wrap(~country, ...) +
    # force_panelsizes(rows = unit(1.3, "in"), 
    #                  cols = unit(.7, "in"), 
    #                  TRUE) +
    theme(axis.text.x  = element_text(size = 7,
                                      angle = 90,
                                      vjust = .45,
                                      hjust = .95),
          strip.text.x = element_text(size = facet_text_size),
          strip.background = element_rect(fill = "white", colour = "white"),
          plot.title = element_text(size=8)) +
    ggtitle("PGE Scores Over Time by Country")
}

ts_plot(region_countries_pge_summary[["Europe"]], 
        facet_text_size = 6,
        nrow = 5) + 
  change_plot("Europe") +
  plot_layout(widths = c(6, 1)) +
  note
```


```{r europe_trends, eval=FALSE}
europe_country_trends <- region_country_trends("Europe")

save(europe_country_trends, file = here("data", "europe_country_trends.rda"))
```

```{r europe_trends_plot}
load(here("data", "europe_country_trends.rda"))
```

\pagebreak
\newpage
### Latin America and the Caribbean

Latin America and the Caribbean encompass the next largest number of countries and include one of the places with the world's most gender egalitarian attitudes with regard to politics and the workplace, Puerto Rico.
Figure&nbsp;\ref{latam_map} shows the most recent PGE scores, as point estimates, for the region.
It shows that public opinion in Latin America has generally become favorable to gender equality in the public sphere.
In addition to Puerto Rico, Uruguay and Costa Rica have PGE scores of .75 or higher in the most recent available year.
Argentina, Mexico, and Brazil---countries with three of the four biggest populations in the region---also exhibit gender egalitarianism scores nearly that high.
The Latin American countries with the lowest levels of gender egalitarianism are Guyana and Haiti, but as with the least egalitarian countries in Europe, even these countries' most recent PGE scores are around .5, putting them not far below the median of all countries.

```{r latam_map, fig.cap="PGE Scores Across Latin America and the Caribbean, Most Recent Available Year \\label{latam_map}", fig.height = 9}
region_maps[[2]] +
  theme(legend.position = c(.01, .01),
        legend.justification = c(0, 0))
```



```{r latam_ts, fig.cap="PGE Scores in Latin America and the Caribbean Over Time \\label{latam_ts}", fig.height = 9, cache=FALSE}
ts_plot(region_countries_pge_summary[["Latin America & Caribbean"]], nrow = 5) + change_plot("Latin America & Caribbean") +
  plot_layout(widths = c(5, 1)) +
  note
```

How PGE scores in Latin America and the Caribbean have changed over time is shown in Figure&nbsp;\ref{latam_ts}.
Attitudes shifted the most in Costa Rica, Argentina, and Mexico, moving about a fifth of the theoretical range of the measure over the years spanned by our observations.
But in nearly half of the region's countries, the difference in the estimated level of public gender egalitarianism from the first observed year to the last observed year is indistinguishable from zero.
These countries are listed, from Panama to Suriname, towards the bottom of the rightmost pane of Figure&nbsp;\ref{latam_ts}.
Still, only in Suriname did the public's views grow decisively less gender egalitarian, at least according to the 80% credible interval, over the observed time span.

```{r latam_trends, eval=FALSE}
latam_country_trends <- region_country_trends("Latin America & Caribbean")

save(latam_country_trends, file = here("data", "latam_country_trends.rda"))
```

```{r latam_trends_plot}
load(here("data", "latam_country_trends.rda"))
```

\pagebreak
### East Asia and the Pacific

The countries of East Asia and the Pacific exhibit more variation than the countries of either of the two regions discussed above.
Figure&nbsp;\ref{eapac_map} shows the point estimates of the most recent PGE scores for each territory in the region.
In New Zealand and Australia, these PGE scores exceed .75 in the most recent year available. 
On the other hand, attitudes remain decidedly opposed in gender equality in politics and the workplace in Myanmar.
South Korea, where a PGE score just above .5 indicates the public is nearly evenly split in its views, constitutes the median of the region, with Japan and China close to either side.

```{r eapac_map, fig.cap="PGE Scores Across East Asia and the Pacific, Most Recent Available Year \\label{eapac_map}", fig.height = 9, cache=FALSE}
region_maps[[3]] +
  theme(legend.position = c(.01, .01),
        legend.justification = c(0, 0))
```



```{r eapac_ts, fig.cap="PGE Scores in East Asia and the Pacific Over Time \\label{eapac_ts}", fig.height = 5.4}
ts_plot(region_countries_pge_summary[["East Asia & Pacific"]], 
        nrow = 3) + 
  change_plot("East Asia & Pacific",
              axis_text_size = 9) +
  plot_layout(widths = c(6, 1)) +
  note
```

Figure&nbsp;\ref{eapac_ts} shows how attitudes toward gender equality have evolved over time in the region.
Comparing the first observed year to the last, nine of the seventeen countries and territories saw gains in public gender egalitarianism whose 80% credible intervals exclude zero, with the biggest increases occurring in Australia, South Korea, and Thailand.
In six places---China, Vietnam, Mongolia, Myanmar, Macao, and the Philippines---the change from the first to last observed year is not distinguishable from zero.
The public in both Cambodia and Indonesia registered a relatively small but statistically discernible decline in gender egalitarianism over the time observed.

\pagebreak
\newpage
### The Middle East and North Africa

The available survey data described in the first section of this chapter allows us to estimate public gender egalitarianism in fifteen countries across the Middle East and North Africa.
The most recent point-estimate PGE scores that resulted in these countries are mapped in Figure&nbsp;\ref{mena_map}.
Attitudes are most egalitarian at the western end of the Mediterranean, exceeding .6 in both in Lebanon and in Israel.
Public gender egalitarianism scores of over .5 are found in Tunisia and Morocco.
Views toward equality between women and men at work and in politics are more negative in the rest of the region, particularly in Saudi Arabia, Iraq, and Yemen.
The most recent PGE score is roughly .25 in each of these last three countries.

```{r mena_map, fig.cap="PGE Scores Across the Middle East and North Africa, Most Recent Available Year \\label{mena_map}", fig.height = 3.5}
region_maps[[4]] +
  theme(legend.position = c(.01, .01),
        legend.justification = c(0, 0),
        legend.direction = "horizontal") +
  guides(color = FALSE)
```



```{r mena_ts, fig.cap="PGE Scores in the Middle East and North Africa Over Time \\label{mena_ts}", fig.height = 5.4, cache=FALSE}
ts_plot(region_countries_pge_summary[["Middle East & North Africa"]] %>% 
          filter(!country == "Malta"), 
        nrow = 3) + 
  change_plot("Middle East & North Africa",
              axis_text_size = 9) +
  plot_layout(widths = c(6, 1)) +
  note
```

The trend over time in how the public considers gender equality in each of the countries of the Middle East and North Africa is plotted in Figure&nbsp;\ref{mena_ts}.
Most of the countries for which data are available have seen some increase over the time observed, and indeed in Morocco, Tunisia, and Lebanon, these increases exceeded a fifth of the entire theoretical PGE scale.
Gains in gender egalitarianism were not distinguishable from zero in Algeria, Yemen, Libya, and Saudi Arabia.
Public gender egalitarianism was estimated to decline over the years observed in Bahrain and Israel, though only in the former country does the 80% credible interval of this drop exclude zero.

\pagebreak
\newpage
### Sub-Saharan Africa

Although sub-Saharan Africa is a large region encompassing over forty countries, it is also among the parts of the world most neglected by survey research.
Moreover, the premier survey of the region, the Afrobarometer, unfortunately does not include questions regarding gender equality in politics or work.
As a result, even the PGE dataset includes only fourteen countries in the region, and generally over relatively short time periods.
Still, these fourteen countries include eight of sub-Saharan Africa's ten most populous, missing only Congo-Kinshasa and Angola, and together the included countries account for nearly two-thirds of the region's total population.

Figure&nbsp;\ref{ssa_map} maps the point estimates of the most recent PGE scores of these countries.
Zambia and Tanzania are the countries where public opinion is the most gender egalitarian, with scores over .6, in the region.
Kenya, South Africa, Rwanda, Ethiopia, and Zimbabwe score at or above .5 in the most recent available year.
Of these countries, attitudes toward gender are least egalitarian in Sudan, Senegal, Mali, and particularly Burkina Faso.
The most recent point estimates for Burkina Faso are the lowest of all of the countries in the PGE dataset (see Figure&nbsp;\ref{cs_mry}).

```{r ssa_map, fig.cap="PGE Scores Across Sub-Saharan Africa, Most Recent Available Year \\label{ssa_map}", fig.height = 9}
region_maps[[5]] +
  theme(legend.position = c(.01, .01),
        legend.justification = c(0, 0))
```

```{r ssa_ts, fig.cap="PGE Scores in Sub-Saharan Africa Over Time \\label{ssa_ts}", fig.height = 5.4, cache=FALSE}
ts_plot(region_countries_pge_summary[["Sub-Saharan Africa"]],
        nrow = 3) + 
  change_plot("Sub-Saharan Africa",
              axis_text_size = 9) +
  plot_layout(widths = c(6, 1)) +
  note
```

Figure&nbsp;\ref{ssa_ts} shows how the public's views on gender equality in the public sphere have changed over time, and the differences across sub-Saharan countries are stark.
The sparse data on attitudes in Zambia, covering only the three-year period from 2007 to 2009, indicates there was a small but sharp uptick in egalitarian views during that time. 
Of the fourteen countries included in the PGE data, only Sudan also saw an increase in public gender egalitarianism from the first observed year to the last, albeit a small one and from a very low base.
Attitudes shifted considerably over time in Tanzania and Nigeria, but ended up roughly where they began in both of these cases.
Trends in Ghana, Uganda, Burkina Faso, and Senegal all exhibit well-estimated declines in gender egalitarian public opinion.

\pagebreak
\newpage
### Central Asia
The availability of relevant survey data allows better coverage of the countries of Central Asia than of sub-Saharan Africa, with only Tajikistan and Turkmenistan excluded from the PGE dataset for want of surveys.
The most recent year of PGE point estimates available in the region is mapped in Figure&nbsp;\ref{casia_map}.
Only in Georgia does this score exceed .5, and there only barely: gender egalitarian views are not widespread in this part of the world.
Across the region, public opinion is least favorable to gender equality in the public sphere in Uzbekistan.
The point estimate of the most recent PGE score, that is, putting aside uncertainty, is scarcely above .2 in that country, making it one of the least gender egalitarian countries in the PGE dataset (see Figure &nbsp;\ref{cs_mry}).

```{r casia_map, fig.cap="PGE Scores Across Central Asia, Most Recent Available Year \\label{casia_map}", fig.height = 3.6}
region_maps[[6]] +
  theme(legend.position = c(.99, .01),
        legend.justification = c(1, 0),
        legend.direction = "horizontal") +
  guides(color = FALSE)
```

```{r casia_ts, fig.cap="PGE Scores in Central Asia Over Time \\label{casia_ts}", fig.height = 3.6, cache=FALSE}
ts_plot(region_countries_pge_summary[["Central Asia"]],
        nrow = 2) + 
  change_plot("Central Asia",
              axis_text_size = 9) +
  plot_layout(widths = c(6, 1)) +
  note
```

How PGE scores have changed in Central Asia over the years is depicted in  Figure&nbsp;\ref{casia_ts}.
Georgia and Armenia have seen attitudes toward gender equality trend upwards over the past quarter-century by roughly a fifth of the PGE scale's range or more.
Public gender egalitarianism has increased slightly and slowly from the first to last observed year in Russia, Kazakhstan, and Azerbaijan.
Uzbekistan saw little change.
But according to the PGE data, public opinion regarding gender equality declined considerably in Kyrgyzstan.

\pagebreak
\newpage
### South Asia
Across South Asia, the available survey data allows us to estimate PGE scores for only five of the region's seven countries; there are no estimates for Afghanistan or Bhutan.
The top panel of Figure&nbsp;\ref{sasia_map} provides a map showing the most recent score, as a point estimate, for each of the remaining countries.
These estimates are below .5 for all of the South Asian countries: indeed, only for Sri Lanka does .5 even fall within the 80% credible interval.
The public in each of these countries is, in the aggregate, opposed to gender equality in politics and in the workforce.
This is particularly true in Pakistan, where the most recent PGE score is estimated to be below .25, among the lowest in the PGE database (see Figure &nbsp;\ref{cs_mry}).

```{r sasia_map, fig.cap="PGE Scores Across South Asia, Most Recent Available Year \\label{sasia_map}", fig.height = 9}
sasia_layout <- "
AAAAAA
AAAAAA
AAAAAA
AAAAAA
AAAAAA
CCCCCB
"

(region_maps[[7]] +
  theme(legend.position = c(.01, .01),
        legend.justification = c(0, 0)) +
    change_plot("South Asia",
              axis_text_size = 9)) +
ts_plot(region_countries_pge_summary[["South Asia"]],
        nrow = 1) + 
  plot_layout(design = sasia_layout) +
  note  
```

Moreover, as shown in the trends over time are shown at the bottom of the figure, public attitudes toward gender equality in most of these countries have been veering downward.
Only in Sri Lanka do the available data suggest that views have remained unchanged since the first observed year, 2005.
In Pakistan, Bangladesh, and India, PGE scores appear to have declined by roughly a tenth of the index's full range, and in Nepal they have fallen by approximately twice that amount.

\pagebreak
\newpage
### North America
Canada and the United States comprise the last region of our survey of public gender egalitarianism around the world.
As shown in the top panel of Figure&nbsp;\ref{noram_map}, the point estimates of both countries' most recent PGE scores are fairly high.
Each is around the .75 mark, comparable to such countries as Austria and Croatia in central Europe, Costa Rica and Mexico in Latin America, and Australia in the Pacific, but substantially lower than the most egalitarian countries of northern and western Europe, Puerto Rico, or New Zealand (see again Figure&nbsp;\ref{cs_mry}).

```{r noram_map, fig.cap="PGE Scores Across North America, Most Recent Available Year \\label{noram_map}", fig.height = 5}
noram_layout <- "
AAAAAA
AAAAAA
AAAAAA
AAAAAA
BB###C
"

(region_maps[[8]] +
  theme(legend.position = c(.01, .99),
        legend.justification = c(0, 1)) +
    ts_plot(region_countries_pge_summary[["North America"]],
        nrow = 1) +
    change_plot("North America",
              axis_text_size = 9)) +
  plot_layout(design = noram_layout) +
  note  
```

Their similar recent scores notwithstanding, the lower panels of Figure&nbsp;\ref{noram_map} show that public gender egalitarianism in Canada and in the United States followed very different trajectories over the past three decades.
In the United States, PGE scores have climbed slowly but rather steadily over this time.
In fact, although this time frame does not entirely appear on the plot, the public's views toward gender egalitarianism in work and politics have grown more positive in this fashion since 1972, gaining some 30% of the full theoretical range of the PGE index since then.
Canadians' attitudes, on the other hand, were already quite gender egalitarian in 1990, the first year for which PGE scores in the country are available.
In the intervening years, egalitarianism may have fallen slightly, only to recover in the latter half of the 2010s and then again decline somewhat after 2020.
The difference between the first and last observed years in Canada cannot be distinguished from zero.


## Conclusions

Despite ample theorizing on the role of public opinion regarding gender equality in politics and the workplace---that is, macroegalitarianism---empirical evidence has been limited, consisting of studies of one or a few cross-sections or based on dubious proxies.
The reason for this regrettable outcome is the want of data on this concept that is comparable both across countries and over time.
The PGE dataset addresses this need.

It does so by compiling the available survey data on the subject and estimating a latent variable model built to take into account the both the differences in the items asked---i.e., their incomparability---and the variation across countries and years in the number of these items that are available---that is, their sparsity.
The result is a set of complete time-series in countries around the world, a comparable measure of the public's attitudes toward equality for women and men in the public sphere, the traditionally male domain of politics and paid employment, along with quantified uncertainty in this measure.
The PGE dataset covers nearly 3,000 country-years, almost six times as many as provided by the most commonly asked single survey item.

We take advantage of this new measure of macroegalitarianism to address the dynamics of the long-standing questions on the interplay between collective attitudes on gender roles and the actions of parties and governments.
In the next chapter, we consider the influence of macroegalitarianism on the election of women to national legislatures [see, e.g., @Paxton2003; @Alexander2012], and examine whether women legislators in turn shape attitudes.

\pagebreak