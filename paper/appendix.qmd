# Appendices

```{r setup, include=FALSE}
options(tinytex.verbose = TRUE)

knitr::opts_chunk$set(cache = FALSE, echo = FALSE, message = FALSE, warning = FALSE)

# If `DCPOtools` is not yet installed:
# remotes::install_github("fsolt/DCPOtools")

# If development version of `DCPO` is not yet installed:
# remotes::install_github("fsolt/DCPO")

library(DCPOtools)
library(DCPO)
library(tidyverse)
library(glue)
library(countrycode)
library(patchwork)
library(modelsummary)

set.seed(324)
```

\pagebreak
# Appendix A: Survey Items Used to Estimate Public Gender Egalitarianism and Their Distribution
```{r egr_summary_stats, cache = FALSE, cache.extra = tools::md5sum(here::here("data-raw", "dcpo_input_raw_public.csv"))}
dcpo_input_raw_public <- read_csv(here::here("data", "dcpo_input_raw_public.csv"),
                                  col_types = "cdcddcd")

public_items <- read_csv(here::here("data-raw", "public_items.csv"),
                         col_types = "ccddd")

process_dcpo_input_raw <- function(dcpo_input_raw_df) {
  dcpo_input_raw_df %>% 
    with_min_yrs(2) %>% 
    with_min_cy(5) %>% 
    filter(year >= 1972) %>% 
    group_by(country) %>% 
    mutate(cc_rank = n()) %>% 
    ungroup() %>% 
    arrange(-cc_rank)
} 

dcpo_input_raw_public1 <- process_dcpo_input_raw(dcpo_input_raw_public) %>% 
  left_join(public_items, by = "item")
dcpo_input_raw_poliwork1 <- dcpo_input_raw_public1 %>% 
  filter(political==1|workplace==1)

surveys_egr <- read_csv(here::here("data-raw", "surveys_egr_classification.csv"),
                        col_types = "ccccnnn")

n_surveys <- surveys_egr %>% 
  filter(agreed == 1) %>%
  distinct(survey) %>% 
  nrow()

n_items <- dcpo_input_raw_poliwork1 %>%
  distinct(item) %>% 
  nrow()

n_countries <- dcpo_input_raw_poliwork1 %>%
  distinct(country) %>% 
  nrow()

n_cy <- dcpo_input_raw_poliwork1 %>%
  distinct(country, year) %>% 
  nrow() %>% 
  scales::comma()

n_years <- as.integer(summary(dcpo_input_raw_poliwork1$year)[6]-summary(dcpo_input_raw_poliwork1$year)[1])

spanned_cy <- dcpo_input_raw_poliwork1 %>% 
  group_by(country) %>% 
  summarize(years = max(year) - min(year) + 1) %>% 
  summarize(n = sum(years)) %>% 
  pull(n) %>% 
  scales::comma()

total_cy <- {n_countries * n_years} %>% 
  scales::comma()

year_range <- paste("from",
                    summary(dcpo_input_raw_poliwork1$year)[1],
                    "to",
                    summary(dcpo_input_raw_poliwork1$year)[6])

n_cyi <- dcpo_input_raw_poliwork1 %>% 
  distinct(country, year, item) %>% 
  nrow() %>% 
  scales::comma()

back_to_numeric <- function(string_number) {
  string_number %>% 
    str_replace(",", "") %>% 
    as.numeric()
}
```
National and cross-national surveys have often included questions tapping attitudes toward equality for women and men in the public sphere over the past half-century, but the resulting data are both sparse, that is, unavailable for many countries and years, and incomparable, generated by many different survey items.
In all, we identified `r n_items` such survey items that were asked in no fewer than five country-years in countries surveyed at least twice; these items were drawn from `r n_surveys` different survey datasets.
These items are listed in the table below, along with the dispersion ($\alpha$) and difficulty ($\beta$) scores estimated for each from the DCPO model.
Question text may vary slightly across survey datasets, but not, roughly speaking, by more than the translation differences across languages found within the typical cross-national survey dataset.
Lower values of dispersion indicate questions that better identify publics with more public gender egalitarianism from those with less.
Items have one less difficulty score than the number of response categories.
Survey dataset codes correspond to those used in the `DCPOtools` R package; they appear in decreasing order of country-years contributed.

Together, the survey items in the source data were asked in `r n_countries` different countries in at least two time points over `r n_years` years, `r year_range`, yielding a total of `r n_cyi` country-year-item observations.
The number of items observed in the source data for each country-year is plotted in FigureÂ \ref{obs_by_cy} below.
The PGE scores of country-years with more observed items are likely to be estimated more precisely.
The estimates for country-years with fewer (or no) observed items rely more heavily (or entirely) on the random-walk prior and are therefore less certain.

Overlap among items have not been a concern in the literature on generating latent-variable estimates of public opinion across countries and over time from sparse data, largely because the dynamic aspect of the models employed, that is, the random-walk prior, works to tie together items that do not overlap [see @Claassen2019; @Caughey2019; @Solt2020c]. 
Nevertheless, the most commonly observed item in the PGE source data, `polileader4`, effectively serves as the bridge between the other items: it has overlapping country-year observations with 39 of the other 50 items (which together cover 91% of the observed country-years), and only a single item (`politics4a`, which covers 22 country-years) had no observations within a year of a `polileader4` observation.

